<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prompt Artisan v2.6.2 (Final Layout)</title>
    <style>
        :root {
            --bg-color: #1a1a2e; --container-bg: #16213e; --input-bg: #0f3460;
            --text-color: #e94560; --light-text: #dcdcdc; --border-color: #e94560;
            --button-bg: #e94560; --button-hover: #c43751; --manual-edit-border: #f9d71c;
            --delete-bg: #a83232; --delete-hover: #802626;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color); color: var(--light-text); margin: 0; padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto; background-color: var(--container-bg);
            padding: 25px; border-radius: 10px; box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        h1 {
            color: var(--text-color); text-align: center; border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px; margin-top: auto; margin-bottom: 25px;
        }
        h2 { text-align: left; border: none; padding-bottom: 5px; margin-top: 25px; font-size: 1.2em; color: var(--text-color);}
        h3 { color: var(--light-text); margin: 15px 0 5px; font-size: 1em; opacity: 0.85; }
        .form-section { margin-bottom: 20px; }
        .sub-section { padding-left: 15px; border-left: 2px solid var(--input-bg); }

        .input-group {
            position: relative;
            margin-bottom: 10px;
            display: flex;
            align-items: stretch;
        }
        textarea, input[type="text"], select {
            width: 100%; background-color: var(--input-bg);
            border: 1px solid var(--border-color); border-radius: 5px; color: var(--light-text);
            padding: 10px; font-size: 1em; box-sizing: border-box;
        }
        textarea { min-height: 60px; resize: vertical; flex: 1; }
        textarea:focus, input:focus, select:focus { outline: none; box-shadow: 0 0 10px var(--text-color); }

        .input-group {
    display: flex;
    align-items: center; /* центрируем textarea и стрелки по вертикали */
    margin-bottom: 10px;
    gap: 5px;
}

.input-group textarea {
    flex: 1;
    min-height: 60px;
    resize: vertical; /* можно растягивать вниз */
}

/* стрелки теперь блок справа */
.weight-controls {
    display: flex;
    flex-direction: column;
    justify-content: center; /* центрируем внутри контейнера */
    gap: 3px;
    height: 100%; /* тянем блок стрелок по высоте textarea */
}

.weight-btn {
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: var(--light-text);
    width: 20px;
    height: 20px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.7em;
    font-weight: bold;
    line-height: 1;
    transition: background-color 0.2s;
    user-select: none;
}

}

        }
        .weight-btn:hover { background-color: var(--button-bg); }

        textarea.manual-edit { border-color: var(--manual-edit-border); }
        textarea.manual-edit:focus { box-shadow: 0 0 10px var(--manual-edit-border); }

        .actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px; }
        button {
            padding: 10px 15px; border: none; border-radius: 5px; background-color: var(--button-bg);
            color: white; font-size: 1em; cursor: pointer; transition: background-color 0.2s;
        }
        button:hover { background-color: var(--button-hover); }
        button#rebuild-prompt, button#clear-form { background-color: #555; }
        button#rebuild-prompt:hover, button#clear-form:hover { background-color: #777; }
        button#delete-preset-btn { background-color: var(--delete-bg); }
        button#delete-preset-btn:hover { background-color: var(--delete-hover); }

        .preset-controls { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
        .preset-controls input { flex: 1 1 150px; }
        .preset-controls select { flex: 1 1 200px; }
        .preset-controls button { flex: 0 0 auto; }

        #output-positive, #output-negative { font-family: 'Courier New', Courier, monospace; font-weight: bold; }

        footer {
            text-align: center; margin-top: 40px; padding-top: 20px;
            border-top: 1px solid var(--input-bg); color: var(--light-text);
            opacity: 0.6; font-size: 0.9em;
        }

        /* --- ФИНАЛЬНАЯ ВЕРСТКА --- */
        .main-content { display: block; }

        @media (min-width: 1200px) {
    .main-content {
        display: grid;
        grid-template-columns: 3fr 2fr;
        gap: 30px;
        align-items: stretch; /* тянем колонки одинаково по высоте */
    }

    /* Убираем фон/карточку */
    .sidebar, .main-content > form {
        background: none;
        border-radius: 0;
        padding: 0;
    }
}



        .sidebar .form-section:first-child h2
    </style>
</head>
<body>
    <div class="container">
        <h1>Prompt Artisan v2.6.2</h1>

        <div class="main-content">
            <form id="prompt-form">
                <div class="form-section"><h2>1. Качество и Стиль</h2><div class="input-group"><textarea id="quality" class="prompt-part savable-field">masterpiece, best quality, anime style</textarea><div class="weight-controls"><button type="button" class="weight-btn" data-action="increase" title="Усилить ((...))">▲</button><button type="button" class="weight-btn" data-action="decrease" title="Ослабить [...]">▼</button></div></div></div>
                <h2>2. Персонаж</h2>
                <div class="sub-section">
                    <h3>2.1. Основа</h3><div class="input-group"><textarea id="identity" class="prompt-part savable-field" placeholder="1girl, solo, elf..."></textarea><div class="weight-controls"><button type="button" class="weight-btn" data-action="increase">▲</button><button type="button" class="weight-btn" data-action="decrease">▼</button></div></div>
                    <h3>2.2. Голова и Лицо</h3><div class="input-group"><textarea id="head" class="prompt-part savable-field" placeholder="long silver hair..."></textarea><div class="weight-controls"><button type="button" class="weight-btn" data-action="increase">▲</button><button type="button" class="weight-btn" data-action="decrease">▼</button></div></div>
                    <h3>2.3. Тело (Анатомия)</h3><div class="input-group"><textarea id="body" class="prompt-part savable-field" placeholder="slender, curvy..."></textarea><div class="weight-controls"><button type="button" class="weight-btn" data-action="increase">▲</button><button type="button" class="weight-btn" data-action="decrease">▼</button></div></div>
                    <h3>2.4. Одежда</h3><div class="input-group"><textarea id="clothing" class="prompt-part savable-field" placeholder="school uniform..."></textarea><div class="weight-controls"><button type="button" class="weight-btn" data-action="increase">▲</button><button type="button" class="weight-btn" data-action="decrease">▼</button></div></div>
                    <h3>2.5. Аксессуары</h3><div class="input-group"><textarea id="accessories" class="prompt-part savable-field" placeholder="glasses, choker..."></textarea><div class="weight-controls"><button type="button" class="weight-btn" data-action="increase">▲</button><button type="button" class="weight-btn" data-action="decrease">▼</button></div></div>
                </div>
                <div class="form-section"><h2>3. Поза и Действие</h2><div class="input-group"><textarea id="pose" class="prompt-part savable-field" placeholder="standing..."></textarea><div class="weight-controls"><button type="button" class="weight-btn" data-action="increase">▲</button><button type="button" class="weight-btn" data-action="decrease">▼</button></div></div></div>
                <div class="form-section"><h2>4. Окружение</h2><div class="input-group"><textarea id="environment" class="prompt-part savable-field" placeholder="on a rooftop..."></textarea><div class="weight-controls"><button type="button" class="weight-btn" data-action="increase">▲</button><button type="button" class="weight-btn" data-action="decrease">▼</button></div></div></div>
                <div class="form-section"><h2>5. Композиция</h2><div class="input-group"><textarea id="composition" class="prompt-part savable-field" placeholder="full body..."></textarea><div class="weight-controls"><button type="button" class="weight-btn" data-action="increase">▲</button><button type="button" class="weight-btn" data-action="decrease">▼</button></div></div></div>
                <div class="form-section"><h2>6. LoRA / LyCORIS</h2><div class="input-group"><textarea id="loras" class="savable-field" placeholder="<lora:your_lora_name:0.8>"></textarea></div></div>
                <button type="reset" id="clear-form">Очистить форму</button>
            </form>
            <div class="sidebar">
                <div class="form-section"><h2>Positive Prompt</h2><textarea id="output-positive" rows="8"></textarea><div class="actions"><button id="rebuild-prompt" title="Пересобрать промпт">⟳</button><button id="copy-positive">Копировать</button></div></div>
                <div class="form-section"><h2>Negative Prompt</h2><textarea id="output-negative" rows="5"></textarea><div class="actions"><button id="copy-negative">Копировать</button></div></div>
                <div class="form-section"><h2>Пресеты</h2><div class="preset-controls"><input type="text" id="preset-name" placeholder="Имя пресета..."><button id="save-preset-btn">Сохранить</button><select id="preset-select"><option>--- Загрузить ---</option></select><button id="delete-preset-btn">Удалить</button></div></div>
            </div>
        </div>

        <footer>Prompt Artisan © 2024 | create by meider</footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // JS без изменений
            const form = document.getElementById('prompt-form');
            const promptParts = document.querySelectorAll('.prompt-part');
            const savableFields = document.querySelectorAll('.savable-field');
            const positiveOutput = document.getElementById('output-positive');
            const negativeOutput = document.getElementById('output-negative');
            const loraInput = document.getElementById('loras');
            const copyPositiveBtn = document.getElementById('copy-positive');
            const copyNegativeBtn = document.getElementById('copy-negative');
            const rebuildBtn = document.getElementById('rebuild-prompt');
            const presetNameInput = document.getElementById('preset-name');
            const presetSelect = document.getElementById('preset-select');
            const savePresetBtn = document.getElementById('save-preset-btn');
            const deletePresetBtn = document.getElementById('delete-preset-btn');
            let isManualEditMode = false;
            const defaultNegativePrompt = "lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry, artist name, bad feet";
            const PRESETS_KEY = 'promptArtisanPresets_v2_6_2';
            let savedPresets = {};
            const splitTags = (value) => value.split(',').map(s => s.trim()).filter(Boolean);
            const generatePrompt = () => {
                if (isManualEditMode) return;
                let allTags = [];
                promptParts.forEach(el => { allTags = allTags.concat(splitTags(el.value)); });
                const promptCore = allTags.join(', ');
                const loraString = loraInput.value.trim();
                positiveOutput.value = (loraString ? loraString + ' ' : '') + promptCore;
            };
            const stripBrackets = (str) => {
                let result = '';
                for (let i = 0; i < str.length; i++) {
                    const char = str[i];
                    if (char !== '(' && char !== ')' && char !== '[' && char !== ']') {
                        result += char;
                    }
                }
                return result.trim();
            };
            const handleWeightControl = (e) => {
                const button = e.target.closest('.weight-btn');
                if (!button) return;
                e.preventDefault();
                const group = button.closest('.input-group');
                const textarea = group.querySelector('textarea');
                if (!textarea) return;
                const start = textarea.selectionStart;
                const end = textarea.selectionEnd;
                if (start === end) return;
                const selectedText = textarea.value.substring(start, end);
                const cleanedText = stripBrackets(selectedText);
                if (!cleanedText) return;
                const action = button.dataset.action;
                const newText = action === 'increase' ? `((${cleanedText}))` : `[${cleanedText}]`;
                textarea.setRangeText(newText, start, end, 'select');
                textarea.focus();
                form.dispatchEvent(new Event('input'));
            };
            const setManualEditMode = (isManual) => {
                isManualEditMode = isManual;
                positiveOutput.classList.toggle('manual-edit', isManual);
            };
            const copyText = (element, button) => {
                navigator.clipboard.writeText(element.value).then(() => {
                    const originalText = button.textContent;
                    button.textContent = 'Скопировано!';
                    setTimeout(() => { button.textContent = originalText; }, 1500);
                });
            };
            const populatePresetDropdown = () => {
                presetSelect.innerHTML = '<option>--- Загрузить ---</option>';
                Object.keys(savedPresets).sort().forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    presetSelect.appendChild(option);
                });
            };
            const loadPresetsFromStorage = () => {
                const presetsJSON = localStorage.getItem(PRESETS_KEY);
                savedPresets = presetsJSON ? JSON.parse(presetsJSON) : {};
                populatePresetDropdown();
            };
            const savePresetsToStorage = () => {
                localStorage.setItem(PRESETS_KEY, JSON.stringify(savedPresets));
            };
            const handleSavePreset = () => {
                const name = presetNameInput.value.trim();
                if (!name) { alert('Введите имя пресета.'); return; }
                const presetData = {};
                savableFields.forEach(el => { presetData[el.id] = el.value; });
                savedPresets[name] = presetData;
                savePresetsToStorage();
                populatePresetDropdown();
                presetSelect.value = name;
                alert(`Пресет "${name}" сохранен!`);
            };
            const handleLoadPreset = () => {
                const name = presetSelect.value;
                if (!savedPresets[name]) return;
                const presetData = savedPresets[name];
                savableFields.forEach(el => { el.value = presetData[el.id] || ''; });
                setManualEditMode(false);
                generatePrompt();
            };
            const handleDeletePreset = () => {
                const name = presetSelect.value;
                if (!savedPresets[name]) { alert('Выберите пресет для удаления.'); return; }
                if (confirm(`Удалить пресет "${name}"?`)) {
                    delete savedPresets[name];
                    savePresetsToStorage();
                    populatePresetDropdown();
                    presetNameInput.value = '';
                    alert(`Пресет "${name}" удален.`);
                }
            };
            form.addEventListener('input', generatePrompt);
            form.addEventListener('mousedown', handleWeightControl);
            positiveOutput.addEventListener('input', () => setManualEditMode(true));
            rebuildBtn.addEventListener('click', () => { setManualEditMode(false); generatePrompt(); });
            form.addEventListener('reset', () => { setManualEditMode(false); setTimeout(generatePrompt, 0); });
            copyPositiveBtn.addEventListener('click', () => copyText(positiveOutput, copyPositiveBtn));
            copyNegativeBtn.addEventListener('click', () => copyText(negativeOutput, copyNegativeBtn));
            savePresetBtn.addEventListener('click', handleSavePreset);
            presetSelect.addEventListener('change', handleLoadPreset);
            deletePresetBtn.addEventListener('click', handleDeletePreset);
            negativeOutput.value = defaultNegativePrompt;
            loadPresetsFromStorage();
            generatePrompt();
        });
    </script>
</body>
</html>
